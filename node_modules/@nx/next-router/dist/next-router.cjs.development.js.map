{"version":3,"file":"next-router.cjs.development.js","sources":["../src/utils/index.ts","../src/Route/Route.ts","../src/utils/events.ts","../src/Router/Router.ts","../src/Link/Link.tsx","../src/hocs/withNextRouter.tsx","../src/index.ts"],"sourcesContent":["export const getUrlParams = (queryString: string) => {\n  if (!queryString) {\n    return {};\n  }\n  let hashes = queryString.split('&');\n  let params: { [key: string]: string | null } = {};\n  hashes.forEach(hash => {\n    let [key, val] = hash.split('=');\n    if (key) {\n      params[key] = val ? decodeURIComponent(val) : null;\n    }\n  });\n\n  return params;\n};\n","import { PathFunction, Key, pathToRegexp, compile } from 'path-to-regexp';\nimport { getUrlParams } from './../utils';\nimport { RouteMatch } from '../types';\n\nclass Route {\n  private page: string;\n  private keys: Key[];\n  private compiled: PathFunction;\n  private regex: RegExp;\n\n  constructor(pattern: string, page: string) {\n    this.page = page;\n    this.compiled = compile(pattern, { encode: encodeURIComponent });\n    this.keys = [];\n    // @ts-ignore\n    this.regex = pathToRegexp(pattern, this.keys);\n  }\n\n  private valuesToParams(values: any, keys: Key[]) {\n    return values.reduce((params: any, val: any, i: number) => {\n      if (val === undefined) return params;\n      return Object.assign(params, {\n        [keys[i].name]: decodeURIComponent(val),\n      });\n    }, {});\n  }\n\n  match(asPath: string): RouteMatch {\n    const asPathSplitted = asPath.split('#');\n    const asPathNoHash = asPathSplitted[0];\n\n    const asPathNoHashSplitted = asPathNoHash.split('?');\n    const asPathNoHashNoQuery = asPathNoHashSplitted[0];\n\n    // get query params\n    let queryParams = {};\n    if (asPathNoHashSplitted.length > 1) {\n      queryParams = getUrlParams(asPathNoHashSplitted[1]);\n    }\n\n    // get hash\n    const hash = asPathSplitted.length > 1 ? asPathSplitted[1] : '';\n\n    const match = this.regex.exec(asPathNoHashNoQuery);\n    if (match !== null) {\n      const params = this.valuesToParams(match.slice(1), this.keys);\n      return {\n        params,\n        query: queryParams,\n        hash,\n        path: asPath,\n        page: this.page,\n        matched: true,\n      };\n    }\n    return {\n      params: {},\n      query: queryParams,\n      hash: hash,\n      path: asPath,\n      page: '',\n      matched: false,\n    };\n  }\n\n  assemble(params: any): string {\n    const compiled = this.compiled(params);\n    return compiled === '' ? '/' : compiled.replace(/%23/g, '#');\n  }\n\n  getPage(): string {\n    return this.page;\n  }\n}\n\nexport default Route;\n","import { default as NextRouter } from 'next/router';\nimport Router from 'Router/Router';\n\ntype Handler = (...evts: any[]) => void;\n\nexport type EventType =\n  | 'routeChangeStart'\n  | 'beforeHistoryChange'\n  | 'routeChangeComplete'\n  | 'routeChangeError'\n  | 'hashChangeStart'\n  | 'hashChangeComplete';\n\nexport type Events = {\n  on(type: EventType, handler: Handler): void;\n  off(type: EventType, handler: Handler): void;\n};\n\ntype Handlers = { handler: Handler; handlerRouter: Handler };\n\ntype Cache = { [s: string]: Handlers[] };\n\nconst getHandlerRouter = (router: Router, handler: Handler) => (\n  ...evts: any[]\n) => {\n  let url = evts[0];\n  if (evts.length > 1 && typeof evts[1] === 'string') {\n    url = evts[1];\n  }\n  const routerMatch = router.match(url);\n  const currentRoute = router.currentRouteFromMatch(routerMatch);\n  if (evts.length === 1) {\n    handler(currentRoute);\n  } else {\n    handler(evts[0], currentRoute);\n  }\n};\n\nconst findHandlersIndex = (arr: Handlers[], handler: Handler) => {\n  return arr.findIndex(handlers => {\n    return handlers.handler === handler;\n  });\n};\n\nexport default function events(router: Router): Events {\n  const all: Cache = Object.create(null);\n\n  return {\n    on(type: EventType, handler: Handler) {\n      const handlerRouter = getHandlerRouter(router, handler);\n      NextRouter.events.on(type, handlerRouter);\n      (all[type] || (all[type] = [])).push({ handler, handlerRouter });\n    },\n    off(type: EventType, handler: Handler) {\n      if (all[type]) {\n        const handlersIndex = findHandlersIndex(all[type], handler);\n        if (handlersIndex >= 0) {\n          const handlerRouter = all[type][handlersIndex].handlerRouter;\n          NextRouter.events.off(type, handlerRouter);\n          all[type].splice(handlersIndex, 1);\n        }\n      }\n    },\n  };\n}\n","import { default as NextRouter } from 'next/router';\nimport {\n  RouterMatch,\n  CurrentRoute,\n  Routes,\n  RouteAssemble,\n  LinkProps,\n} from '../types';\nimport Route from '../Route';\nimport events, { Events } from '../utils/events';\n\nclass Router {\n  private routes: { [key: string]: Route } = {};\n  private currentRoute: CurrentRoute = null;\n  public events: Events;\n\n  constructor(routes: Routes) {\n    this.setRoutes(routes);\n    this.events = events(this);\n  }\n\n  setRoutes(routes: Routes): void {\n    this.routes = {};\n    this.addRoutes(routes);\n  }\n\n  addRoutes(routes: Routes): void {\n    for (const route in routes) {\n      if (!routes.hasOwnProperty(route)) {\n        continue;\n      }\n      this.routes[route] = new Route(routes[route].pattern, routes[route].page);\n    }\n  }\n\n  getRoutes(): { [key: string]: Route } {\n    return this.routes;\n  }\n\n  match(asPath: string): RouterMatch {\n    for (const route in this.routes) {\n      if (!this.routes.hasOwnProperty(route)) {\n        continue;\n      }\n\n      const matched = this.routes[route].match(asPath);\n      if (matched.matched) {\n        return { ...matched, route };\n      }\n    }\n\n    return {\n      route: '',\n      params: {},\n      query: {},\n      path: asPath,\n      page: '',\n      hash: '',\n      matched: false,\n    };\n  }\n\n  assemble(route: string, params: any): RouteAssemble {\n    if (this.routes[route]) {\n      return {\n        path: this.routes[route].assemble(params),\n        page: this.routes[route].getPage(),\n      };\n    }\n    throw new Error('next-router: No route matched');\n  }\n\n  getLinkProps(route: string, params: any = {}, hash: string = ''): LinkProps {\n    const assembled = this.assemble(route, params);\n    const hashSuffix = hash !== '' ? `#${hash}` : '';\n    return {\n      href: { pathname: assembled.page, query: params },\n      as: `${assembled.path}${hashSuffix}`,\n    };\n  }\n\n  getLinkPropsFromHref(\n    href: string,\n    transformFn: (href: string) => string = href => href\n  ): LinkProps {\n    const hrefSlash = href.substr(0, 1) !== '/' ? `/${href}` : href;\n    const match = this.match(transformFn(hrefSlash));\n    if (match.matched) {\n      return this.getLinkProps(match.route, match.params, match.hash);\n    }\n    return {\n      href,\n      as: href,\n    };\n  }\n\n  push(\n    route: string,\n    params: any = {},\n    hash: string = '',\n    options: any = {}\n  ): Promise<boolean> {\n    const props = this.getLinkProps(route, params, hash);\n    return NextRouter.push(props.href, props.as, options);\n  }\n\n  pushHref(href: string, options: any = {}): Promise<boolean> {\n    const props = this.getLinkPropsFromHref(href);\n    return NextRouter.push(props.href, props.as, options);\n  }\n\n  replace(\n    route: string,\n    params: any = {},\n    hash: string = '',\n    options: any = {}\n  ): Promise<boolean> {\n    const props = this.getLinkProps(route, params, hash);\n    return NextRouter.replace(props.href, props.as, options);\n  }\n\n  replaceHref(href: string, options: any = {}): Promise<boolean> {\n    const props = this.getLinkPropsFromHref(href);\n    return NextRouter.replace(props.href, props.as, options);\n  }\n\n  getRequestHandler(renderFunction: Function) {\n    return (req: any, res: any, next: any) => {\n      // don't render next url's\n      const isNextUrl = req.url.match(/^\\/_next|^\\/static/);\n      if (isNextUrl) {\n        return next();\n      }\n\n      // try to match request url\n      const { matched, route, page, params, query, hash } = this.match(req.url);\n\n      if (matched) {\n        // set current route for later access\n        this.setCurrentRoute({ route, page, params, query, hash });\n\n        // call render function\n        if (renderFunction) {\n          return renderFunction(req, res, page, params, query, route);\n        }\n      }\n\n      next();\n    };\n  }\n\n  currentRouteFromMatch(routerMatch: RouterMatch): CurrentRoute {\n    const { route, page, params, query, hash } = routerMatch;\n    return {\n      route,\n      page,\n      params,\n      query,\n      hash,\n    };\n  }\n\n  setCurrentRoute(currentRoute: CurrentRoute) {\n    this.currentRoute = currentRoute;\n  }\n\n  getCurrentRoute(): CurrentRoute {\n    return this.currentRoute;\n  }\n}\n\nexport default Router;\n","import * as React from 'react';\nimport NextLink from 'next/link';\nimport Router from '../Router';\n\nexport type LinkProps = {\n  route?: string;\n  params?: any;\n  hash?: string;\n  href?: string;\n  children: React.ReactElement<any>;\n  [key: string]: any;\n};\n\nconst Link = (router: Router) => ({\n  route,\n  params = {},\n  hash = '',\n  href,\n  children,\n  ...props\n}: LinkProps) => {\n  if (!route && !href) {\n    throw new Error(\n      'next-router: You have to provide a route or a href to the Link'\n    );\n  }\n\n  let mergedProps;\n\n  if (route) {\n    mergedProps = { ...router.getLinkProps(route, params, hash), ...props };\n  } else {\n    mergedProps = { ...router.getLinkPropsFromHref(href || ''), ...props };\n  }\n\n  return <NextLink {...mergedProps}>{children}</NextLink>;\n};\n\nexport default Link;\n","import * as React from 'react';\nimport { NextComponentType } from 'next';\nimport { AppContext } from 'next/app';\nimport Router from './../Router';\nimport { CurrentRoute, RouterMatch } from './../types';\n\ninterface WrappedAppProps {\n  initialProps: any;\n  nextRouter_currentRoute: CurrentRoute;\n}\n\nconst getRouterMatch = (appCtx: AppContext, router: Router): RouterMatch => {\n  const asPath = appCtx.ctx.asPath || '';\n  return router.match(asPath);\n};\n\nexport default (\n  router: Router,\n  getRouterMatchFunction?: (appCtx: AppContext, router: Router) => RouterMatch\n) => {\n  if (!getRouterMatchFunction) {\n    getRouterMatchFunction = getRouterMatch;\n  }\n\n  return (App: NextComponentType | any) =>\n    class WrappedApp extends React.Component<WrappedAppProps> {\n      public static getInitialProps = async (appCtx: AppContext) => {\n        let initialProps = {};\n\n        let routerMatch: RouterMatch = {\n          route: '',\n          params: {},\n          query: {},\n          path: '',\n          page: '',\n          hash: '',\n          matched: false,\n        };\n\n        if (getRouterMatchFunction) {\n          routerMatch = getRouterMatchFunction(appCtx, router);\n        }\n\n        if (!routerMatch.matched) {\n          if (appCtx.ctx.res) {\n            appCtx.ctx.res.statusCode = 404;\n          }\n        }\n\n        const { route, page, params, query, hash } = routerMatch;\n        const nextRouter_currentRoute = { route, page, params, query, hash };\n        router.setCurrentRoute(nextRouter_currentRoute);\n\n        appCtx.ctx.query = { ...query, ...params };\n\n        if ('getInitialProps' in App) {\n          initialProps = await App.getInitialProps.call(App, appCtx);\n        }\n\n        return {\n          nextRouter_currentRoute,\n          initialProps,\n        };\n      };\n\n      public render() {\n        const { initialProps, nextRouter_currentRoute, ...props } = this.props;\n\n        // set current route on hydration\n        if (!router.getCurrentRoute()) {\n          router.setCurrentRoute(nextRouter_currentRoute);\n        }\n\n        return <App {...props} {...initialProps} />;\n      }\n    };\n};\n","import NextLink from 'next/link';\nimport Router from './Router';\nimport Link from './Link';\nimport withNextRouterFactory from './hocs/withNextRouter';\nimport { CurrentRoute, RouterMatch, Routes } from './types';\nimport { AppContext } from 'next/app';\n\nlet router: Router;\nlet link;\nlet withNextRouter;\n\ninterface Constructable<T> {\n  new (routes: Routes): T;\n}\n\nexport const init = (\n  routes: Routes,\n  RouterClass?: Constructable<Router>,\n  LinkFactory?: (router: Router) => typeof NextLink,\n  getRouterMatchFunction?: (appCtx: AppContext, router: Router) => RouterMatch\n) => {\n  router = RouterClass ? new RouterClass(routes) : new Router(routes);\n  link = LinkFactory ? LinkFactory(router) : Link(router);\n  withNextRouter = withNextRouterFactory(router, getRouterMatchFunction);\n};\n\nconst useRouter = (): CurrentRoute => {\n  if (!router) {\n    throw new Error(\n      'next-router: Router is not set. You have to initialize next-router first.'\n    );\n  }\n  return router.getCurrentRoute();\n};\n\nexport { Router as RouterClass, Link as LinkFactory, withNextRouterFactory };\nexport { router as Router };\nexport { link as Link };\nexport { withNextRouter, useRouter };\nexport { default as RouteClass } from './Route';\nexport {\n  Routes,\n  RouteMatch,\n  RouteAssemble,\n  LinkProps,\n  CurrentRoute,\n} from './types';\n"],"names":["getUrlParams","queryString","hashes","split","params","forEach","hash","key","val","decodeURIComponent","Route","pattern","page","compiled","compile","encode","encodeURIComponent","keys","regex","pathToRegexp","valuesToParams","values","reduce","i","undefined","Object","assign","name","match","asPath","asPathSplitted","asPathNoHash","asPathNoHashSplitted","asPathNoHashNoQuery","queryParams","length","exec","slice","query","path","matched","assemble","replace","getPage","getHandlerRouter","router","handler","url","routerMatch","currentRoute","currentRouteFromMatch","findHandlersIndex","arr","findIndex","handlers","events","all","create","on","type","handlerRouter","NextRouter","push","off","handlersIndex","splice","Router","routes","setRoutes","addRoutes","route","hasOwnProperty","getRoutes","Error","getLinkProps","assembled","hashSuffix","href","pathname","as","getLinkPropsFromHref","transformFn","hrefSlash","substr","options","props","pushHref","replaceHref","getRequestHandler","renderFunction","req","res","next","isNextUrl","setCurrentRoute","getCurrentRoute","Link","children","mergedProps","React","NextLink","getRouterMatch","appCtx","ctx","getRouterMatchFunction","App","render","initialProps","nextRouter_currentRoute","_a","statusCode","getInitialProps","call","init","RouterClass","LinkFactory","link","withNextRouter","withNextRouterFactory","useRouter"],"mappings":"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"}